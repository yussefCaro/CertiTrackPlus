{% extends 'layouts/base.html' %}

{% block content %}
    <h1>{{ titulo }}</h1>

    <h2>Cotización: {{ cotizacion.numero_servicio }}</h2>

    <form method="post">
        {% csrf_token %}

        <label for="fecha_programacion_etapa1">Fecha de Programación Etapa 1:</label>
        <input type="date" name="fecha_programacion_etapa1" required>

        <label for="hora_etapa1">Hora Etapa 1:</label>
        <input type="time" name="hora_etapa1" required>

       <label>Fechas de Programación Etapa 2 (máximo 3):</label>
<div id="fechas_etapa2_container">
    <div class="fecha_etapa2">
        <input type="date" name="fecha_programacion_etapa2[]" required>
        <input type="time" name="hora_etapa2[]" required>
    </div>
</div>
<button type="button" id="agregar_fecha_etapa2">Agregar otra fecha</button>



        <fieldset>
            <legend>Seleccionar Auditores</legend>
            {% for auditor in form.auditores.field.queryset %}
                <label>
                    <input type="checkbox" name="auditores" value="{{ auditor.id }}">
                    {{ auditor.nombre }} - {{ auditor.cargo }}
                </label><br>
            {% endfor %}
        </fieldset>

        <label>
            <input type="checkbox" name="iaf_md4_confirmado">
            Confirmación IAF MD4
        </label>

        <button type="submit">{{ boton_texto }}</button>
    </form>

    <a href="{% url 'listado_programaciones' %}">Volver al listado</a>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const container = document.getElementById("fechas_etapa2_container");
    const addButton = document.getElementById("agregar_fecha_etapa2");

    addButton.addEventListener("click", function() {
        const currentFields = container.getElementsByClassName("fecha_etapa2");

        if (currentFields.length < 3) {  // Máximo 3 fechas
            const div = document.createElement("div");
            div.classList.add("fecha_etapa2");
            div.innerHTML = `
                <input type="date" name="fecha_programacion_etapa2[]" required>
                <input type="time" name="hora_etapa2[]" required>
                <button type="button" class="eliminar_fecha">❌</button>
            `;
            container.appendChild(div);

            // Agregar evento para eliminar la fecha
            div.querySelector(".eliminar_fecha").addEventListener("click", function() {
                div.remove();
            });
        } else {
            alert("Solo puedes agregar hasta 3 fechas.");
        }
    });
});
</script>



{% endblock %}
